- name: Validate JSON against config schema
  run: |
    echo "ğŸ” Validating JSON config files..."
    python << 'EOF'
    import json, sys
    from pathlib import Path
    from jsonschema import validate, ValidationError
    
    # Load config schema
    schema_path = Path('.github/schemas/config-schema.json')
    with open(schema_path) as f:
        config_schema = json.load(f)
    
    # SKIP these generated/auto-updated files
    SKIP_PATTERNS = [
        '.aions-structure-list/',  # Your scanner output
        'node_modules/',
        '__pycache__/',
        '.git/',
        'dist/',
        'build/'
    ]
    
    errors = []
    validated_count = 0
    
    for json_file in Path('.').rglob('*.json'):
        # Skip generated/auto files
        if any(pattern in str(json_file) for pattern in SKIP_PATTERNS):
            continue
        
        try:
            with open(json_file) as f:
                content = json.load(f)
            
            validate(instance=content, schema=config_schema)
            print(f"âœ… {json_file}")
            validated_count += 1
            
        except json.JSONDecodeError as e:
            errors.append(f"{json_file}: Invalid JSON - {e}")
        except ValidationError as e:
            errors.append(f"{json_file}: Schema violation - {e.message}")
    
    if errors:
        print(f"\nâŒ Found {len(errors)} error(s) in {validated_count} JSON file(s):")
        for error in errors:
            print(f"  - {error}")
        sys.exit(1)
    else:
        print(f"\nâœ… All {validated_count} JSON config files passed validation")
    EOF