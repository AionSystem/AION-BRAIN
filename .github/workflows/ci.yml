name: AION Consolidated CI

on: [push, pull_request]

jobs:
  lint-python:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      - name: Install & Lint
        run: |
          pip install pylint
          # Your discovery + lint logic...
      - uses: actions/upload-artifact@v4
        with:
          name: python-lint-report
          path: pylint_output.txt

  # Similar updates for lint-docs & test-python: add cache where possible

  validate-docs-structure:  # New job — surprise tie-in to your frameworks
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check FSVE/GENESIS invariants
        run: |
          echo "Scanning for core principles..."
          grep -r -i "Uncertainty Is Conserved" . || echo "⚠️ Missing key principle refs"
          grep -r -i "No Free Certainty" . || echo "⚠️ Principle 1 not found"
          # Add more checks: header consistency, etc.
          # Fail if critical missing (optional)

  report:
    needs: [lint-python, lint-docs, test-python, validate-docs-structure]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          path: artifacts
          pattern: '*-report'
          merge-multiple: true
      - name: Build Master Report
        run: |
          # Your logic, but safer path handling:
          cat artifacts/*/pylint_output.txt >> combined.txt  # etc.
          # Generate MASTER_REPORT.md with better formatting
      - uses: actions/upload-artifact@v4
        with:
          name: aion-ci-master-report
          path: MASTER_REPORT.md